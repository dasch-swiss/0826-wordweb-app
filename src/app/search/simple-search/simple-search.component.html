<div class="search-container" fxLayout="column" fxLayout.gt-sm="row" fxLayoutAlign.gt-sm="center start"
     fxLayoutGap="30px">

    <mat-card fxFlex.gt-sm="350px">
        <mat-card-content>
            <form [formGroup]="form" (ngSubmit)="search()" fxLayout="column">
                <table>
                    <tr>
                        <td>
                            <mat-form-field>
                                <mat-label>Text</mat-label>
                                <input matInput formControlName="text" (keydown.escape)="clear('text')">
                                <button *ngIf="form.get('text').value" type="button" mat-button matSuffix
                                        mat-icon-button aria-label="Clear" (click)="clear('text')">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </mat-form-field>
                        </td>
                        <td class="min">
                            <mat-icon matSuffix (click)="getHelpText('text')">help</mat-icon>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <mat-form-field>
                                <mat-label>Title</mat-label>
                                <input matInput formControlName="bookTitle" (keydown.escape)="clear('bookTitle')">
                                <button *ngIf="form.get('bookTitle').value" type="button" mat-button matSuffix
                                        mat-icon-button aria-label="Clear" (click)="clear('bookTitle')">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </mat-form-field>
                        </td>
                        <td class="min">
                            <mat-icon matSuffix (click)="getHelpText('title')">help</mat-icon>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <mat-form-field>
                                <mat-label>Author</mat-label>
                                <input matInput formControlName="author" (keydown.escape)="clear('author')">
                                <button *ngIf="form.get('author').value" type="button" mat-button matSuffix
                                        mat-icon-button aria-label="Clear" (click)="clear('author')">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </mat-form-field>
                        </td>
                        <td class="min">
                            <mat-icon matSuffix (click)="getHelpText('author')">help</mat-icon>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <mat-form-field>
                                <mat-label>Lexia</mat-label>
                                <input matInput formControlName="lexia" (keydown.escape)="clear('lexia')">
                                <button *ngIf="form.get('lexia').value" type="button" mat-button matSuffix
                                        mat-icon-button aria-label="Clear" (click)="clear('lexia')">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </mat-form-field>
                        </td>
                        <td class="min">
                            <mat-icon matSuffix (click)="getHelpText('lexia')">help</mat-icon>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <mat-form-field>
                                <mat-label>Date</mat-label>
                                <input matInput formControlName="date" placeholder="1662 or 1662-1664" type="number"
                                       (keydown.escape)="clear('date')">
                            </mat-form-field>
                        </td>
                        <td class="min">
                            <mat-icon matSuffix (click)="getHelpText('date')">help</mat-icon>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align: right;">
                            <mat-slide-toggle formControlName="plays" [color]="'warn'">
                                Show only plays
                            </mat-slide-toggle>
                        </td>
                        <td class="min">
                            <mat-icon matSuffix (click)="getHelpText('plays')">help</mat-icon>
                        </td>
                    </tr>
                </table>

                <button [disabled]="form.invalid" type="submit" mat-flat-button>SEARCH</button>
            </form>
        </mat-card-content>
    </mat-card>

    <div class="result-container" fxFlex.gt-sm="550px">

        <div *ngIf="passages" fxLayout="column" fxLayoutGap="10px">
            <div fxLayout="row" fxLayoutAlign="space-between center">
                <div>{{passages.length}} <span *ngIf="nPassages | async as total"> of {{total}} Results</span></div>
                <mat-form-field>
                    <mat-label>Sort</mat-label>
                    <mat-select (selectionChange)="setOrder($event)">
                        <mat-option [value]="'Author'">Author</mat-option>
                        <mat-option [value]="'Title'">Title</mat-option>
                        <mat-option [value]="'Date'">Date</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <div class="result" *ngFor="let passage of passages; let pIndex = index;">
                <div class="result-text">
                    <div style="text-align: right; font-size: smaller;">[{{pIndex + 1}}]</div>
                    <span style="font-weight: bold;" *ngFor="let book of passage.occursIn; let bIndex = index">
                        <span *ngFor="let author of book.isWrittenBy; let aFirst = first">
                            <span><span *ngIf="!aFirst">, </span>{{author.hasFirstName[0]?.value}} {{author.hasLastName[0].value}}</span>
                        </span>: <span style="font-style: italic">{{book.hasBookTitle[0].value}}</span>
                    </span>
                    <div [innerHTML]="passage.original ? passage.hasTextHist[0].value : passage.hasText[0].value"></div>
                    <div style="margin-top: 1rem;">
                        <div style="font-style: italic;text-align: right;" *ngFor="let lexia of passage.contains; let lIndex = index">
                            <span>{{lexia.hasLexiaDisplayedTitle[0].value}}</span>
                        </div>
                        <button style="margin-top: 1rem;" [disabled]="false" (click)="expandOrClose(passage)">{{expandBtnText(passage)}}</button>
                    </div>
                </div>

                <div class="details" [class.opened]="passage.expanded">
                    <div *ngIf="!detailPassages[passage.id]" class="spinner-container">
                        <ngx-spinner name="spinner-{{passage.id}}"></ngx-spinner>
                    </div>
                    <div *ngIf="detailPassages[passage.id]">
                        <div style="margin-top: 1rem;">
                            <div>{{detailPassages[passage.id].text}}</div>
                            <button *ngIf="passage.hasTextHist" style="margin-top: 1rem;" (click)="originalOrNormalized(passage)">{{spellingBtnText(passage)}}</button>
                        </div>
                    </div>
                </div>
            </div>

            <!--            <mat-card *ngFor="let passage of passages; let i = index;">-->
            <!--                <mat-card-content fxLayout="row" fxLayoutGap="10px" fxLayoutAlign="space-between">-->
            <!--                    <div *ngFor="let book of passage.occursIn">-->
            <!--                        <span *ngFor="let author of book.isWrittenBy">-->
            <!--                            <span *ngFor="let fn of author.hasFirstName">{{fn.value}} </span>-->
            <!--                            <span *ngFor="let ln of author.hasLastName">{{ln.value}} </span>-->
            <!--                        </span>-->
            <!--                        <span *ngFor="let bn of book.hasBookTitle">{{bn.value}}</span>-->
            <!--                        <div [innerHTML]="passage.hasText[0].value"></div>-->
            <!--                    </div>-->
            <!--                    <mat-card-subtitle>[{{i + 1}}]</mat-card-subtitle>-->
            <!--                </mat-card-content>-->
            <!--                <mat-card-actions>-->
            <!--                    <button mat-button>-->
            <!--                        Expand-->
            <!--                    </button>-->
            <!--                </mat-card-actions>-->
            <!--            </mat-card>-->

            <div class="no-results" *ngIf="passages.length === 0">
                No results were found
            </div>

            <div class="load-more" *ngIf="!searchStarted && passages.length !== 0">
                <button mat-button *ngIf="passages.length !== (nPassages | async)" (click)="loadMoreResults()">
                    Load more
                </button>
            </div>

            <div class="spinner-small" *ngIf="searchStarted && passages.length !== 0">
                <ngx-spinner name="spinner-small"></ngx-spinner>
            </div>

        </div>

        <div class="error" *ngIf="errorObject && !searchStarted">
            <div class="img-container">
                <img src="assets/error.png" alt="Shakespeare is confused" height="128"/>
            </div>
            <div class="text">
                <div class="title">Oh no!</div>
                <div>Even Shakespeare had to deal with errors in his plays.<br>So he tried later.</div>
            </div>
        </div>

        <div class="spinner-big" *ngIf="!passages">
            <ngx-spinner name="spinner-big"></ngx-spinner>
        </div>

    </div>

</div>

